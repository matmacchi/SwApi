@model SwApi.Models.AssemblyView

@{
    ViewData["Title"] = "Create";
}

<h1>Create</h1>

<h4>Assembly</h4>
<hr />
<div class="row">
    <div class="col-md-4">
        <form asp-action="Create">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group">
                <label for="AssemblyLabel">Assembly Label</label>
                <input type="text" id="AssemblyLabel" name="AssemblyLabel" />
            </div>
            <div class="form-group">
                @Html.DropDownList("PreAssemblyChoices", Model.PreAssemblyChoices as MultiSelectList, "Pre Assembly", new { @class = "custom-select" })
            </div>
            <div class="form-part2 hidden">
                <div class="form-group">
                    <label for="Equations" class="conrol-label"></label>
                    <div class="input-group">
                        <select name="Equations" id="Equations" multiple="multiple" class="js-tags form-control">
                        </select>
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="button" data-toggle="modal" data-target="#addEquationSetter">Add</button>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="ListParts" class="control-label">Part Toggles</label>
                    <div class="input-group">
                    <select name="PartToggles" id="PartToggles" multiple="multiple" class="js-tags form-control">
                    </select>
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="button" data-toggle="modal" data-target="#addPartToggle">Add</button>
                    </div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <input type="submit" value="Create" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>

<div>
    <a asp-action="Index">Back to List</a>
</div>

<div id="addEquationSetter" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="addEquationSetter" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="container">
                <form id="AddEquationSetterForm" action="../Ajax/AddEquationSetter" method="post">
                    <div class="form-group">
                        <label for="Label" class="control-label">Label</label>
                        <input type="text" name="Label" id="Label" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label for="EquationTarget" class="conrol-label">Equation Target</label>
                        <select class="form-control" id="EquationTarget" name="EquationTarget">
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="DefaultValue">Default Value</label>
                        <input type="number" id="DefaultValue" class="DefaultValue" />
                    </div>
                    <div class="form-group">
                        <label for="MinValue">Min Value</label>
                        <input type="number" id="MinValue" name="MinValue" class="MinValue" />
                    </div>
                    <div class="form-group">
                        <label for="MaxValue">Max Value</label>
                        <input type="number" id="MaxValue" name="MaxValue" class="MaxValue" />
                    </div>
                    <div class="form-group">
                        <label for="StepValue">Step Value</label>
                        <input type="number" id="StepValue" name="StepValue" class="StepValue" />
                    </div>
                    <div class="form-group">
                        <label for="ReferenceTag">Reference Tag</label>
                        <input type="text" id="ReferenceTag" name="ReferenceTag" class="ReferenceTag" />
                    </div>
                    <input type="submit" value="Add" class="btn btn-primary" />
                </form>
            </div>
        </div>
    </div>
</div>


<div id="addPartToggle" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="addPartToggle" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="container">
                <form id="AddPartToggle" action="../Ajax/AddPartToggle" method="post">
                    <div class="form-group">
                        <label for="Label" class="control-label">Label</label>
                        <input type="text" name="Label" id="Label" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label for="PartToggleTarget">PartToggle Target</label>
                        <div class="input-group">
                            <select name="PartToggleTargets" id="PartToggleTargets" multiple="multiple" class="js-tags form-control">
                            </select>
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button" data-toggle="modal" data-target="#addPartToggleTarget">Add</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="ReferenceTag">Reference Tag</label>
                        <input type="text" id="ReferenceTag" name="ReferenceTag" class="ReferenceTag" />
                    </div>
                    <input type="submit" value="Add" class="btn btn-primary" />
                </form>
            </div>
        </div>
    </div>
</div>

<div id="addPartToggleTarget" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="addPartToggleTarget" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="container">
                <form id="AddPartToggleTarget" action="../Ajax/AddPartTarget" method="post">
                    <div class="form-group">
                        <label for="Label" class="control-label">Label</label>
                        <input type="text" name="Label" id="Label" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label for="Label" class="control-label">Part</label>
                        <select name="PartTarget" id="PartTarget" class="js-tags form-control">
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ReferenceTag">Reference</label>
                        <input type="text" id="ReferenceTag" name="ReferenceTag" class="ReferenceTag" />
                    </div>
                    <input type="submit" value="Add" class="btn btn-primary" />
                </form>
            </div>
        </div>
    </div>
</div>



@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script type="text/javascript">
        $(document).ready(function () {

            $('#PreAssemblyChoices').change(function () {
                let preAssembly = $(this).val();
                if (preAssembly != "" || preAssembly != undefined) {
                    $('.form-part2').show();
                } else {
                    $('.form-part2').hide();
                }

                $('#EquationTarget').empty();

                $.ajax({
                    type: "post",
                    url: "../Ajax/GetEquationTargets",
                    data: { PreAssemblyId: preAssembly },
                    success: function (data) {
                        data.forEach(function (e,i) {
                            let o = new Option(i, e);
                            $(o).html(e);
                            $('#EquationTarget').append(o);
                        });
                    }
                });

                $('#PartTarget').empty();

                $.ajax({
                    type: "post",
                    url: "../Ajax/GetPartTargets",
                    data: { PreAssemblyId: preAssembly },
                    success: function (data) {
                        data.forEach(function (e, i) {
                            let o = new Option(i, e);
                            $(o).html(e);
                            $('#PartTarget').append(o);
                        });
                    }
                });

            });

            $(".js-tags").select2({
                tags: true
            });

            $('#AddEquationSetterForm,#AddPartToggle,#AddPartToggleTarget').on('submit', function (e) {

                e.preventDefault();
                let form = $(this);

                $.ajax({
                    type: 'post',
                    url: form.attr('action'),
                    data: form.serialize(),
                    success: function (data) {
                        if (form.attr('id') == 'AddEquationSetterForm') {
                            let o = new Option(data.label, data.id);
                            o.selected = true;
                            $(o).html(data.label);
                            $("#Equations").append(o);
                            $('#addEquationSetter').modal('hide');
                        } else if (form.attr('id') == 'AddPartToggle') {
                            let o = new Option(data.label, data.id);
                            $(o).html(data.label);
                            o.selected = true;
                            $("#PartToggles").append(o);
                            $('#addPartToggle').modal('hide');
                        } else if (form.attr('id') == "AddPartToggleTarget"){
                            let o = new Option(data.label,data.id);
                            o.selected = true;
                            $(o).html(data.label);
                            $("#PartToggleTargets").append(o);
                            $('#addPartToggleTarget').modal('hide');
                        }
                    }
                });

            });


        });
    </script>
}
